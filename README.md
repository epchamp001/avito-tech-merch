# Магазин мерча (Avito)
## Описание
Этот сервис представляет собой API для внутреннего магазина мерча в компании, где сотрудники могут покупать товары за монеты. Также они могут передавать монеты другим сотрудникам. Проект включает следующие функции:

* Регистрация и аутентификация пользователей с использованием JWT.
* Покупка товаров (мерча) за монеты.
* Передача монет между пользователями.
* Просмотр информации о покупке товаров и о перемещении монет в кошельке пользователя.

Сервис поддерживает работу с PostgreSQL и использует Docker для деплоя.

## Стек технологий
* **Язык программирования:** Go
* **База данных:** PostgreSQL
* **Авторизация:** JWT
* **Docker:** Для контейнеризации сервиса и базы данных
* **Тестирование:** Юнит-тесты, интеграционные тесты

## Установка и запуск
1. Клонируйте репозиторий:
```bash
git clone https://github.com/your-repo/avito-tech-merch.git
cd avito-tech-merch
```

2. Создайте .env файл, используя шаблон .env.example, и укажите параметры подключения к базе данных и секретный ключ JWT.
3. Соберите Docker-контейнеры:
```bash
make docker-build
```
4. Запустите сервис с помощью Docker Compose:
```bash
make docker-up
```
5. Проверьте логи приложения:
```bash
make docker-logs
```

## Эндпоинты API
1. **Авторизация (POST /api/auth):**
* Входные данные: {"username": "username", "password": "password"}
* Выходные данные: {"token": "jwt_token"}

2. **Получение информации о пользователе (GET /api/info):**
* Заголовок: Authorization: <JWT_TOKEN>

3. **Передача монет (POST /api/sendCoin):**
* Входные данные: {"toUser": "receiver_username", "amount": 50}
* Заголовок: Authorization: Bearer <JWT_TOKEN>
* Ответ: {"message": "Перевод выполнен"}

4. **Покупка мерча (GET /api/buy/:item):**
* Параметр пути: item — название товара (например, "cup", "t-shirt")
* Заголовок: Authorization: Bearer <JWT_TOKEN>
* Ответ: {"message": "Покупка успешна"}

## Структура базы данных
В базе данных хранятся следующие таблицы:

* **Users:** информация о пользователях
* **Merch:** информация о товарах
* **Transactions:** история переводов монет
* **Purchases:** информация о покупках товаров

## Тесты
Проект включает юнит-тесты для бизнес-логики. Покрытие бизнес-сценариев юнит-тестами составляет **43.2%**.
Также попытался реализовать интеграционные тесты. Но что-то не совсем получается. Я до этого не имел опыт работы с тестированием в Go. Но все же я оставлю свои тесты.

## Итоги
В ходе работы над этим проектом я получил ценный опыт. Это один из самых масштабных проектов, которые я разрабатывал. Впервые я использовал Docker в таком сложном окружении, что позволило мне глубже разобраться в контейнеризации и управлении сервисами.

При разработке я старался следовать архитектурному шаблону Go Clean Template, что помогло структурировать код и сделать его более поддерживаемым. В процессе реализации я столкнулся с рядом сложностей, связанных с организацией зависимостей, тестированием и миграцией базы данных, но их решение значительно прокачало мои навыки.

На данный момент проект использует GORM для работы с базой данных, однако, для большей гибкости, производительности и контроля можно было бы рассмотреть вариант использования "чистого" SQL.

В целом, этот проект стал для меня отличной практикой работы с чистой архитектурой, микросервисами, Docker, JWT-аутентификацией и юнит-тестированием.
